{% extends 'base/base.html' %}
{% load widget_tweaks %}

{% block title %}{% if object %}Editar Prestador{% else %}Novo Prestador{% endif %}{% endblock %}

{% block page_title %}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="card overflow-hidden">
        <div
            class="p-6 border-b border-neutral-200 dark:border-gray-700 bg-neutral-50/50 dark:bg-gray-800/50 flex justify-between items-center">
            <div>
                <h2 class="text-xl font-bold text-neutral-900 dark:text-white">
                    {% if object %}
                    Editar Prestador: <span class="text-neutral-600 font-normal">{{ object.nome }}</span>
                    {% else %}
                    Novo Prestador
                    {% endif %}
                </h2>
                <p class="text-sm text-neutral-500 dark:text-neutral-400 mt-1">Preencha os dados cadastrais do
                    prestador.</p>
            </div>
            {% if object %}
            <span class="badge-neutral">{% if object.active %}Ativo{% else %}Inativo{% endif %}</span>
            {% endif %}
        </div>

        <form method="post" class="p-6 space-y-8" novalidate>
            {% csrf_token %}

            {% if form.non_field_errors %}
            <div class="p-4 bg-red-50 text-red-700 border border-red-200 rounded-lg">
                {% for error in form.non_field_errors %}
                <p class="flex items-center gap-2"><svg class="w-4 h-4" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 8v4m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z">
                        </path>
                    </svg> {{ error }}</p>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Dados Básicos -->
            <div class="space-y-4">
                <h3
                    class="text-sm font-semibold text-neutral-900 dark:text-white uppercase tracking-wider border-b border-neutral-200 pb-2">
                    Dados Básicos</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <label for="{{ form.tipo_pessoa.id_for_label }}" class="form-label">Tipo de Pessoa</label>
                        {% render_field form.tipo_pessoa class="form-select" %}
                    </div>
                    <div class="md:col-span-2">
                        <label for="{{ form.nome.id_for_label }}" class="form-label">Nome Completo / Razão
                            Social</label>
                        {% render_field form.nome class="form-input" %}
                        {% if form.nome.errors %}<p class="form-error">{{ form.nome.errors|first }}</p>{% endif %}
                    </div>
                    <div class="md:col-span-3" id="div_nome_fantasia">
                        <label for="{{ form.nome_fantasia.id_for_label }}" class="form-label">Nome Fantasia</label>
                        {% render_field form.nome_fantasia class="form-input" %}
                    </div>
                </div>
            </div>

            <!-- Documentos -->
            <div class="space-y-4">
                <h3
                    class="text-sm font-semibold text-neutral-900 dark:text-white uppercase tracking-wider border-b border-neutral-200 pb-2">
                    Documentos</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div id="div_cpf">
                        <label for="{{ form.cpf.id_for_label }}" class="form-label">CPF</label>
                        {% render_field form.cpf class="form-input" %}
                        {% if form.cpf.errors %}<p class="form-error">{{ form.cpf.errors|first }}</p>{% endif %}
                    </div>
                    <div id="div_cnpj">
                        <label for="{{ form.cnpj.id_for_label }}" class="form-label">CNPJ</label>
                        {% render_field form.cnpj class="form-input" %}
                        {% if form.cnpj.errors %}<p class="form-error">{{ form.cnpj.errors|first }}</p>{% endif %}
                    </div>
                    <div id="div_rg">
                        <label for="{{ form.rg.id_for_label }}" class="form-label">RG</label>
                        {% render_field form.rg class="form-input" %}
                    </div>
                    <div class="md:col-span-2" id="div_ie">
                        <label for="{{ form.inscricao_estadual.id_for_label }}" class="form-label">Inscrição
                            Estadual</label>
                        {% render_field form.inscricao_estadual class="form-input" %}
                    </div>
                    <div id="div_im">
                        <label for="{{ form.inscricao_municipal.id_for_label }}" class="form-label">Inscrição
                            Municipal</label>
                        {% render_field form.inscricao_municipal class="form-input" %}
                    </div>
                </div>
            </div>

            <!-- Contato -->
            <div class="space-y-4">
                <h3
                    class="text-sm font-semibold text-neutral-900 dark:text-white uppercase tracking-wider border-b border-neutral-200 pb-2">
                    Contato</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="{{ form.email.id_for_label }}" class="form-label">Email</label>
                        {% render_field form.email class="form-input" %}
                        {% if form.email.errors %}<p class="form-error">{{ form.email.errors|first }}</p>{% endif %}
                    </div>
                    <div>
                        <label for="{{ form.telefone.id_for_label }}" class="form-label">Telefone</label>
                        {% render_field form.telefone class="form-input" %}
                    </div>
                </div>
            </div>

            <!-- Endereço -->
            <div class="space-y-4">
                <h3
                    class="text-sm font-semibold text-neutral-900 dark:text-white uppercase tracking-wider border-b border-neutral-200 pb-2">
                    Endereço</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div>
                        <label for="{{ form.cep.id_for_label }}" class="form-label">CEP</label>
                        {% render_field form.cep class="form-input" %}
                    </div>
                    <div class="md:col-span-2">
                        <label for="{{ form.logradouro.id_for_label }}" class="form-label">Logradouro</label>
                        {% render_field form.logradouro class="form-input" %}
                    </div>
                    <div>
                        <label for="{{ form.numero.id_for_label }}" class="form-label">Número</label>
                        {% render_field form.numero class="form-input" %}
                    </div>
                    <div class="md:col-span-2">
                        <label for="{{ form.complemento.id_for_label }}" class="form-label">Complemento</label>
                        {% render_field form.complemento class="form-input" %}
                    </div>
                    <div class="md:col-span-2">
                        <label for="{{ form.bairro.id_for_label }}" class="form-label">Bairro</label>
                        {% render_field form.bairro class="form-input" %}
                    </div>
                    <div class="md:col-span-3">
                        <label for="{{ form.cidade.id_for_label }}" class="form-label">Cidade</label>
                        {% render_field form.cidade class="form-input" %}
                    </div>
                    <div>
                        <label for="{{ form.uf.id_for_label }}" class="form-label">UF</label>
                        {% render_field form.uf class="form-input" %}
                    </div>
                </div>
            </div>

            <!-- Dados Bancários -->
            <div class="space-y-4">
                <h3
                    class="text-sm font-semibold text-neutral-900 dark:text-white uppercase tracking-wider border-b border-neutral-200 pb-2">
                    Dados Bancários</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="md:col-span-2">
                        <label for="{{ form.banco.id_for_label }}" class="form-label">Banco</label>
                        {% render_field form.banco class="form-input" %}
                    </div>
                    <div>
                        <label for="{{ form.agencia.id_for_label }}" class="form-label">Agência</label>
                        {% render_field form.agencia class="form-input" %}
                    </div>
                    <div>
                        <label for="{{ form.conta.id_for_label }}" class="form-label">Conta</label>
                        {% render_field form.conta class="form-input" %}
                    </div>
                    <div class="md:col-span-2">
                        <label for="{{ form.tipo_conta.id_for_label }}" class="form-label">Tipo de Conta</label>
                        {% render_field form.tipo_conta class="form-input" %}
                    </div>
                </div>
            </div>

            <!-- Configurações -->
            <div class="space-y-4">
                <h3
                    class="text-sm font-semibold text-neutral-900 dark:text-white uppercase tracking-wider border-b border-neutral-200 pb-2">
                    Configurações</h3>
                <div>
                    <label for="{{ form.observacoes.id_for_label }}" class="form-label">Observações</label>
                    {% render_field form.observacoes class="form-input" rows="3" %}
                </div>
                <div class="flex items-center">
                    {% render_field form.ativo class="form-checkbox h-4 w-4 text-primary border-gray-300 rounded
                    focus:ring-primary" %}
                    <label for="{{ form.ativo.id_for_label }}"
                        class="ml-2 block text-sm text-neutral-700 dark:text-neutral-300">
                        Prestador Ativo
                    </label>
                </div>
            </div>

            <div class="pt-6 border-t border-neutral-200 dark:border-gray-700 flex justify-end gap-3">
                <a href="{% url 'contratos:prestador_list' %}" class="btn-secondary">Cancelar</a>
                <button type="submit" class="btn-primary">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    {% if object %}Salvar Alterações{% else %}Cadastrar Prestador{% endif %}
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const tipoPessoaField = document.getElementById('id_tipo_pessoa');
        const cpfDiv = document.getElementById('div_cpf');
        const cnpjDiv = document.getElementById('div_cnpj');
        const rgDiv = document.getElementById('div_rg');
        const nomeFantasiaDiv = document.getElementById('div_nome_fantasia');
        const ieDiv = document.getElementById('div_ie');
        const imDiv = document.getElementById('div_im');

        function toggleFields() {
            const tipoPessoa = tipoPessoaField.value;

            if (tipoPessoa === 'PF') {
                if (cpfDiv) cpfDiv.style.display = 'block';
                if (rgDiv) rgDiv.style.display = 'block';

                if (cnpjDiv) cnpjDiv.style.display = 'none';
                if (nomeFantasiaDiv) nomeFantasiaDiv.style.display = 'none';
                if (ieDiv) ieDiv.style.display = 'none';
                if (imDiv) imDiv.style.display = 'none';

            } else if (tipoPessoa === 'PJ') {
                if (cnpjDiv) cnpjDiv.style.display = 'block';
                if (nomeFantasiaDiv) nomeFantasiaDiv.style.display = 'block';
                if (ieDiv) ieDiv.style.display = 'block';
                if (imDiv) imDiv.style.display = 'block';

                if (cpfDiv) cpfDiv.style.display = 'none';
                if (rgDiv) rgDiv.style.display = 'none';
            }
        }

        if (tipoPessoaField) {
            toggleFields();
            tipoPessoaField.addEventListener('change', toggleFields);
        }
    });
</script>
{% endblock %}