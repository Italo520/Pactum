<!-- templates/base/navbar.html -->
{% load static %}
<header class="bg-white shadow-md p-4 flex justify-between items-center">
    <!-- Mobile Menu Toggle -->
    <button class="text-gray-600 focus:outline-none md:hidden" id="sidebarToggle">
        <i class="fas fa-bars fa-lg"></i>
    </button>

    <!-- Search Bar -->
    <div class="relative hidden md:block">
        <form class="relative" method="get" action="{% url 'dashboard:index' %}">
            <span class="absolute inset-y-0 left-0 pl-3 flex items-center">
                <i class="fas fa-search text-gray-400"></i>
            </span>
            <input class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-500"
                   type="search" placeholder="Buscar..." name="q" value="{{ request.GET.q }}">
        </form>
    </div>

    <!-- User Menu -->
    <div class="relative">
        {% if user.is_authenticated %}
            <button class="flex items-center space-x-2 focus:outline-none" id="userMenuButton">
                {% if user.avatar %}
                    <img src="{{ user.avatar.url }}" class="rounded-full h-8 w-8 object-cover">
                {% else %}
                    <span class="inline-block h-8 w-8 rounded-full overflow-hidden bg-gray-200">
                        <svg class="h-full w-full text-gray-400" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M24 20.993V24H0v-2.993A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                    </span>
                {% endif %}
                <span class="hidden md:inline text-gray-700 font-medium">{{ user.get_full_name|default:user.username }}</span>
                <i class="fas fa-chevron-down text-gray-500 text-xs"></i>
            </button>
            <!-- Dropdown Menu -->
            <div id="userMenu" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-20 hidden">
                <a href="{% url 'accounts:profile' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                    <i class="fas fa-user w-6"></i>Perfil
                </a>
                <a href="{% url 'accounts:change_password' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                    <i class="fas fa-key w-6"></i>Alterar Senha
                </a>
                {% if user.is_admin %}
                    <div class="border-t border-gray-200 my-1"></div>
                    <a href="{% url 'accounts:user_list' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                        <i class="fas fa-users w-6"></i>Gerenciar Usu√°rios
                    </a>
                    <a href="/admin/" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                        <i class="fas fa-cog w-6"></i>Admin
                    </a>
                {% endif %}
                <div class="border-t border-gray-200 my-1"></div>
                <a href="{% url 'accounts:logout' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                    <i class="fas fa-sign-out-alt w-6"></i>Sair
                </a>
            </div>
        {% else %}
            <a href="{% url 'accounts:login' %}" class="text-gray-700 font-medium hover:text-green-600">
                <i class="fas fa-sign-in-alt mr-2"></i>Entrar
            </a>
        {% endif %}
    </div>
</header>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const userMenuButton = document.getElementById('userMenuButton');
        const userMenu = document.getElementById('userMenu');

        if (userMenuButton) {
            userMenuButton.addEventListener('click', function(event) {
                userMenu.classList.toggle('hidden');
                event.stopPropagation();
            });
        }

        document.addEventListener('click', function(event) {
            if (userMenu && !userMenu.contains(event.target) && !userMenuButton.contains(event.target)) {
                userMenu.classList.add('hidden');
            }
        });
    });
</script>